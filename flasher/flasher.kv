#:kivy 2.0.0
#:import hex kivy.utils.get_color_from_hex
#:import Factory kivy.factory.Factory
#:import SlideTransition kivy.uix.screenmanager.SlideTransition
#:import FadeTransition kivy.uix.screenmanager.FadeTransition

<FlasherMainScreen>:
    name: "FlasherMainScreen"
    port_select: port_select
    FloatLayout:
        size_hint: (.96, .96)
        pos_hint: {"center_x": 0.5, "center_y": 0.5}
        FloatLayout:
            spacing: [10, 10]
            size_hint: (1, .1)
            pos_hint: {"x": 0, "y": 0.9}
            id: top
            canvas.before:
                Color:
                    rgba: hex('#303136')
                Rectangle:
                    pos: self.pos
                    size: self.size
            Button:
                size_hint: (.2, .8)
                pos_hint: {"center_y": 0.5, "x": 0.008}
                text: "Back"
                on_press:
                    root.manager.transition = SlideTransition()
                    root.manager.transition.direction = 'right'
                    root.manager.current = "MainScreen"
        FloatLayout:
            size_hint: (1, .88)
            pos_hint: {"x": 0, "y": 0}
            GridLayout:
                cols: 2
                size_hint: (.3,.10)
                pos_hint: {"x": .7, "y": .9}
                Label:
                    text: "Port: "
                    size_hint: (.33, 1)
                SerialSpinner:
                    id: port_select
                    text: "<select>"
                    on_text:
                        root.set_upload_port(self.text)
                    on_press: self.refresh()
            GridLayout:
                cols: 2
                size_hint: (.3,.10)
                pos_hint: {"x": 0, "y": .9}
                Label:
                    text: "Project: "
                    size_hint: (.3, 1)
                Button:
                    id: file
                    text: "<select>"
                    size_hint: (.6, 1)
                    on_press:
                        root.manager.transition = FadeTransition()
                        root.manager.current = "PioFileChooserScreen"
<PioFileChooserScreen>:
    name: "PioFileChooserScreen"
    file_chooser: file_chooser
    drive_select: drive_select
    FloatLayout:
        size_hint: (1, 1)
        GridLayout:
            pos_hint: {"x": 0, "y": .9}
            size_hint: (1,.1)
            spacing: [10, 10]
            padding: [10,10,10,10]
            cols: 4
            Button:
                text: "Cancel"
                on_press:
                    root.manager.current = "FlasherMainScreen"
            Label:
                text :"Drive:"
            DriveSipinner:
                id: drive_select
                text: "Home"
                on_press:
                    root.update_drives()
                on_text:
                    root.select_root_path(self.text)
                    
            Button:
                text: "Select"
                on_press:
                    root.manager.current = "FlasherMainScreen"
        BoxLayout:
            size_hint: (1,.8)
            pos_hint: {"x": 0, "y": 0}
            FileChooserListView:
                id: file_chooser
                dirselect: True
                size_hint: (1, 1)
                on_entry_added: root.entityProcessor(args[0], args[1])
                on_touch_down: root.on_touch(self.selection, args[1])



